<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Smart TRK - Map</title>
    <link rel="shortcut icon" href="../../common/favicon.png">
    <link rel="stylesheet" type="text/css" href="../../css/map.css">
    <img src="../../common/syswinBackground.png" class="bg" />
    <link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap.css" />
    <link href="http://demo.bootstraptor.com/contact_bs3/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet">

    <style>
        html, body, #map-canvas {
            width: 100%;
            height: 700px;
            margin: 0px;
            padding: 0px
        }
    </style>

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>

    <script>
        var map;

        var stableLocations = [new google.maps.LatLng(44.434278, 26.034482), new google.maps.LatLng(44.467140, 26.078481), new google.maps.LatLng(44.464506, 26.126246)];
        var alertsLocations = [new google.maps.LatLng(44.426350, 26.091400), new google.maps.LatLng(44.433808, 25.998765)];
        var vehiclesLocations = [new google.maps.LatLng(44.442421, 26.165643), new google.maps.LatLng(44.405542, 26.062686), new google.maps.LatLng(44.457440, 26.060730), new google.maps.LatLng(44.382212, 26.149736)];

        var stableMarkers = [];
        var alertsMarkers = [];
        var vehiclesMarkers = [];

        var displayStable = true;
        var displayAlarms = true;
        var displayVehicles = true;

        var pinPointStable = "../../common/green-PinPoint.png";
        var pinPointAlerts = "../../common/orange-PinPoint.png";
        var pinPointVehicle = "../../common/pinPoint-Vehicle.png";

        var mapCenter;

        function initialize() {
            findCenter();

            var mapOptions = {
                zoom: 12,
                //center: new google.maps.LatLng(44.434912, 26.103115)
                center: mapCenter
            };
            map = new google.maps.Map(document.getElementById('map-canvas'),
                    mapOptions);

            for (var i = 0; i < stableLocations.length; i++) {
                addMarker(stableLocations[i], "stable");
            }

            for (var i = 0; i < alertsLocations.length; i++) {
                addMarker(alertsLocations[i], "alarms");
            }

            for (var i = 0; i < vehiclesLocations.length; i++) {
                addMarker(vehiclesLocations[i], "vehicles");
            }
        }

        google.maps.event.addDomListener(window, 'load', initialize);

        function findCenter(){
            var minLat = 45, maxLat = 45;
            var minLng = 45, maxLng = 45;

            if(stableLocations.length > 0){
                minLat = stableLocations[0].lat();
                maxLat = stableLocations[0].lat();
                minLng = stableLocations[0].lng();
                maxLng = stableLocations[0].lng();
            }
            else if(alertsLocations.length > 0){
                minLat = alertsLocations[0].lat();
                maxLat = alertsLocations[0].lat();
                minLng = alertsLocations[0].lng();
                maxLng = alertsLocations[0].lng();
            }
            else if(vehiclesLocations.length > 0){
                minLat = vehiclesLocations[0].lat();
                maxLat = vehiclesLocations[0].lat();
                minLng = vehiclesLocations[0].lng();
                maxLng = vehiclesLocations[0].lng();
            }

            for (var i = 0; i < stableLocations.length; i++) {
                if(stableLocations[i].lat() < minLat){
                    minLat = stableLocations[i].lat();
                }
                if(stableLocations[i].lat() > maxLat){
                    maxLat = stableLocations[i].lat();
                }

                if(stableLocations[i].lng() < minLng){
                    minLng = stableLocations[i].lng();
                }
                if(stableLocations[i].lng() > maxLng){
                    maxLng = stableLocations[i].lng();
                }
            }

            for (var i = 0; i < alertsLocations.length; i++) {
                if(alertsLocations[i].lat() < minLat){
                    minLat = alertsLocations[i].lat();
                }
                if(stableLocations[i].lat() > maxLat){
                    maxLat = alertsLocations[i].lat();
                }

                if(alertsLocations[i].lng() < minLng){
                    minLng = alertsLocations[i].lng();
                }
                if(alertsLocations[i].lng() > maxLng){
                    maxLng = alertsLocations[i].lng();
                }
            }

            for (var i = 0; i < vehiclesLocations.length; i++) {
                if(vehiclesLocations[i].lat() < minLat){
                    minLat = vehiclesLocations[i].lat();
                }
                if(vehiclesLocations[i].lat() > maxLat){
                    maxLat = vehiclesLocations[i].lat();
                }

                if(vehiclesLocations[i].lng() < minLng){
                    minLng = vehiclesLocations[i].lng();
                }
                if(vehiclesLocations[i].lng() > maxLng){
                    maxLng = vehiclesLocations[i].lng();
                }
            }

            console.log((maxLat + minLat) / 2);
            console.log((maxLng + minLng) /2);
            mapCenter = new google.maps.LatLng((maxLat + minLat) / 2, (maxLng + minLng) /2)
        }

        function addMarker(location, type) {
            var image;

            if( type == "stable"){
                image = pinPointStable;
            }
            if( type == "alarms"){
                image = pinPointAlerts;
            }
            if( type == "vehicles"){
                image = pinPointVehicle;
            }

            var marker = new google.maps.Marker({
                position: location,
                map: map,
                icon: image,
                animation: google.maps.Animation.DROP
            });

            var contentString = '<div id="content">'+
                    '<div id="siteNotice">'+
                        '</div>'+
                        '<h2 id="firstHeading" class="firstHeading">Asset</h2>'+
                        '<div id="bodyContent">'+
                            '<p>TODO: To complete this HTML page.</p>'+
                        '</div>'+
                    '</div>';

            var infowindow = new google.maps.InfoWindow({
                //content: "TODO: To write the information"
                content: contentString
            });

            google.maps.event.addListener(marker, 'click', function() {
                infowindow.open(map, marker);
            });

            if( type == "stable"){
                stableMarkers.push(marker);
            }
            if( type == "alarms"){
                alertsMarkers.push(marker);
            }
            if( type == "vehicles"){
                vehiclesMarkers.push(marker);
            }
        }

        function stableCheckbox(element){
            displayStable = element.checked;
            if (displayStable == true) {
                for (var i = 0; i < stableLocations.length; i++) {
                    addMarker(stableLocations[i], "stable");
                }
            }else{
                for (var i = 0; i < stableMarkers.length; i++) {
                    stableMarkers[i].setMap(null);
                }
                stableMarkers = [];
            }
        }

        function alarmsCheckbox(element){
            displayAlarms = element.checked;
            if (displayAlarms == true) {
                for (var i = 0; i < alertsLocations.length; i++) {
                    addMarker(alertsLocations[i], "alarms");
                }
            }else{
                for (var i = 0; i < alertsMarkers.length; i++) {
                    alertsMarkers[i].setMap(null);
                }
                alertsMarkers = [];
            }
        }

        function vehicleCheckbox(element){
            displayVehicles = element.checked;
            if (displayVehicles == true) {
                for (var i = 0; i < vehiclesLocations.length; i++) {
                    addMarker(vehiclesLocations[i], "vehicles");
                }
            }else{
                for (var i = 0; i < vehiclesMarkers.length; i++) {
                    vehiclesMarkers[i].setMap(null);
                }
                vehiclesMarkers = [];
            }
        }

        setInterval(function() {
            if (displayVehicles == true) {
                for (var i = 0; i < vehiclesMarkers.length; i++) {
                    vehiclesMarkers[i].setPosition(new google.maps.LatLng(vehiclesMarkers[i].getPosition().lat() + 0.0001, vehiclesMarkers[i].getPosition().lng() + 0.0001));
                    vehiclesMarkers[i].setMap(map);
                }
            }
        }, 500);

    </script>

    <style type="text/css">
        body {
            padding-top: 40px;
            padding-bottom: 40px;
        }

        header .jumbotron small{
            color:#fff;
        }
        .main-color {
            color:#358cce;
        }

        input[type="checkbox"] {
            display:none;
        }
        input[type="checkbox"] + label span {
            display:inline-block;
            width:30px;
            height:30px;
            margin:-1px 4px 0 0;
            vertical-align:middle;
            background:url(../../common/small-unchecked.png) top no-repeat;
            cursor:pointer;
        }
        input[type="checkbox"]:checked + label span {
            background:url(../../common/small-checked.png) top no-repeat;
        }
    </style>

</head>
<body>
<header>
    <div class="container">
        <nav class="navbar navbar-default" role="navigation">
            <div class="container-fluid">
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a class="navbar-brand" href="http://dev.threepress.es/syswin/"><strong>Smart <font color="#33ADFF">TRK</font></strong></a></li>
                        <li><a href="../../home.html"><strong><font size="4">Home</font></strong></a></li>
                        <li><a href="../../about.html"><strong><font size="4">About</font></strong></a></li>
                        <li><a href="../../contact.html"><strong><font size="4">Contact</font></strong></a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><strong><font size="4">Options</font></strong><span class="caret"></span></a>
                            <ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
                                <li><a href="../users.html"><strong><font size="3.8">Users</font></strong></a></li>
                                <li class="divider"></li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#"><strong><font size="3.8">Devices</font></strong></a>
                                    <ul class="dropdown-menu">
                                        <li><a href="logs.html"><strong><font size="3">Logs</font></strong></a></li><br>
                                        <li><a href="statistics.html"><strong><font size="3">Statistics</font></strong></a></li><br>
                                        <li><a href="#"><strong><font size="3">Map</font></strong></a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="active"><a href="#"><strong><font size="4">Map</font></strong></a></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        </li><li><p style="float: right" class="navbar-text"><font size="3"><b>USER:</b></font> adminUser</p></li>
                        <li><a style="float: right" href="../../login.html"><font size="3"><i>[logout]</i></font></a></li>
                    </ul>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>
    </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
</header>

    <div class="container">
        <!-- Example row of columns -->
        <div class="row">
            <div class="col-sm-12 col-lg-12">
                <div class="panel">
                    <div class="panel-heading">
                        <h3>
                            <i style="color: #00b3ee" class="icon-location-arrow main-color"></i> Assets Map
                            <div style="float: right;  padding: 0px;">
                                <i style="color: #00b3ee; padding-right: 5px" class="icon-filter main-color"></i><font style="padding-right: 20px;">Filters</font>

                                <form style="display:inline; margin:0px; padding:0px;/" name="input" action="" method="get">
                                    <input onchange="stableCheckbox(this)" type="checkbox" name="stableFilter" id="stable1" checked/>
                                    <label for="stable1" style="-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; color: #3e8f3e; padding-left: 5px; padding-right: 10px"><span></span>Stable</label>

                                    <input onchange="alarmsCheckbox(this)" type="checkbox" name="alarmFilter" id="alarms1" checked/>
                                    <label for="alarms1" style="-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; color: #d58512; padding-left: 5px; padding-right: 10px"><span></span>Alarms</label>

                                    <input onchange="vehicleCheckbox(this)" type="checkbox" name="vehicleFilter" id="vehicles1" checked/>
                                    <label for="vehicles1" style="-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; color: #5C5CD6; padding-left: 5px; padding-right: 10px"><span></span>Vehicles</label>
                                </form>
                            </div>
                        </h3>
                    </div>
                    <div class="panel-body">
                        <div id="map-canvas"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>